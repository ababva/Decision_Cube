DIY Hernya

## Что нужно установить

Перед началом убедитесь, что у вас установлено:
- Docker и Docker Compose
- Java 17 или новее (рекомендуется Java 21+)
- Android Studio (для запуска Android приложения)
- Gradle (обычно устанавливается автоматически с Android Studio)

## Шаг 1: Запуск базы данных

Переходим в папку с docker-конфигурацией:

```bash
cd docker
```

Создаем файл с переменными окружения (если его еще нет):

```bash
cp env.example env
```
# hate 5432
Запускаем базу данных:

```bash
docker-compose up -d
```

Ждем несколько секунд, пока база данных полностью запустится, и проверяем статус:

```bash
docker-compose ps
```

Оба контейнера (postgres и pgadmin) должны быть в статусе "Up" или "healthy". Если что-то не так, смотрите логи:

```bash
docker-compose logs postgres
```

База данных будет доступна по адресу `localhost:5433`. Если хотите подключиться через psql:

```bash
PGPASSWORD=dc_password psql -h localhost -p 5433 -U dc_user -d decision_cube
```

## Шаг 2: Запуск backend

Переходим в папку backend:

```bash
cd ../backend
```

Если у вас установлена Java 24, все должно работать сразу. Если используете другую версию Java, может понадобиться обновить путь в файле `gradle.properties`:

```
org.gradle.java.home=/путь/к/вашей/java
```

Также убедитесь, что в файле `build.gradle.kts` указана совместимая версия Java.

Запускаем backend:

```bash
./gradlew run
```

Если первый раз запускаете, Gradle может скачивать зависимости - это нормально, подождите.

Когда увидите в консоли сообщение "Responding at http://0.0.0.0:8080", значит backend запущен и готов принимать запросы.

Проверить, что все работает, можно простым запросом:

```bash
curl http://localhost:8080/api/users/search
```

Если получили ответ (даже пустой массив или ошибку 500), значит сервер работает. Если connection refused - проверьте, что backend действительно запущен.

Если backend не запускается, возможные причины:
- База данных не запущена. Проверьте: `cd docker && docker-compose ps`
- Неправильный порт базы данных. Проверьте, что в `DatabaseFactory.kt` указан порт 5433
- Проблемы с Java версией. Убедитесь, что используется Java 21 или выше

## Шаг 3: Настройка и запуск Android приложения

### Первый запуск Android Studio

1. **Откройте проект:**
   - Запустите Android Studio
   - Выберите File -> Open
   - Укажите папку с проектом: `/Users/maksimanikeev/projects/Decision_Cube`
   - Нажмите OK

2. **Дождитесь синхронизации Gradle:**
   - Android Studio автоматически начнет синхронизацию Gradle
   - Это займет 5-10 минут при первом запуске (Gradle скачивает зависимости)
   - Прогресс виден внизу справа в Android Studio
   - Если есть ошибки, попробуйте Build -> Sync Project with Gradle Files

3. **Настройте Android SDK (если еще не настроен):**
   - File -> Settings (или Android Studio -> Preferences на Mac)
   - Appearance & Behavior -> System Settings -> Android SDK
   - Во вкладке SDK Platforms установите галочку на Android 14.0 (API 34)
   - Во вкладке SDK Tools убедитесь, что установлены:
     - Android SDK Build-Tools
     - Android SDK Platform-Tools
     - Android Emulator
   - Нажмите Apply и дождитесь установки

4. **Проверьте JDK:**
   - File -> Settings -> Build, Execution, Deployment -> Build Tools -> Gradle
   - В поле Gradle JDK выберите JDK 17 или выше (обычно встроенный в Android Studio)
   - Нажмите OK

### Создание и запуск эмулятора

Если у вас еще нет виртуального устройства:

1. **Создайте устройство:**
   - В Android Studio выберите Tools -> Device Manager
   - Нажмите Create Device
   - Выберите любое устройство из списка (например, Pixel 5)
   - Нажмите Next
   - Выберите системный образ (рекомендуется API 34 - Android 14.0)
     - Если образа нет, нажмите Download рядом с нужным образом
     - Дождитесь скачивания и установки
   - Нажмите Next, затем Finish

2. **Запустите эмулятор:**
   - В Device Manager нажмите кнопку Play (треугольник) рядом с вашим устройством
   - Дождитесь загрузки эмулятора (может занять 1-2 минуты при первом запуске)
   - Когда увидите главный экран Android в эмуляторе - он готов к работе

### Подключение к backend

Для эмулятора настройка уже готова в файле `ApiClient.kt` - используется адрес `10.0.2.2:8080`, который автоматически перенаправляется на localhost вашего компьютера.

Если используете реальное физическое устройство:
1. Узнайте IP адрес вашего компьютера в локальной сети
   - macOS/Linux: `ifconfig | grep "inet "`
   - Windows: `ipconfig`
2. Откройте файл `app/src/main/java/com/decisioncube/app/data/api/ApiClient.kt`
3. Замените `10.0.2.2` на ваш IP адрес (например, `192.168.1.100`)
4. Убедитесь, что телефон и компьютер подключены к одной Wi-Fi сети
5. Проверьте, что файрвол на компьютере не блокирует порт 8080

### Запуск приложения

Перед запуском убедитесь:
- Эмулятор запущен и готов (главный экран Android виден)
- Backend запущен на `http://localhost:8080` (см. Шаг 2)
- База данных запущена (см. Шаг 1)

Теперь запускаем приложение:

1. **Выберите устройство:**
   - Вверху Android Studio в выпадающем списке рядом с зеленой кнопкой Run выберите ваше эмуляторное устройство
   - Если устройства нет в списке - убедитесь, что эмулятор запущен

2. **Запустите приложение:**
   - Нажмите зеленую кнопку Run  вверху Android Studio
   - Или нажмите Shift+F10 (или Ctrl+R на Mac)
   - Android Studio начнет сборку приложения (первые несколько раз это может занять 2-5 минут)

3. **Дождитесь установки:**
   - После сборки приложение автоматически установится на эмулятор
   - Приложение запустится автоматически

Если появляются ошибки при сборке:
- Проверьте, что синхронизация Gradle завершена
- Убедитесь, что SDK установлен правильно (File -> Settings -> Android SDK)
- Попробуйте Build -> Clean Project, затем Build -> Rebuild Project


## Остановка

Чтобы остановить все:

```bash
# Остановить backend - нажмите Ctrl+C в терминале где он запущен

# Остановить базу данных
cd docker
docker-compose down
```

```bash
docker-compose down -v
```
